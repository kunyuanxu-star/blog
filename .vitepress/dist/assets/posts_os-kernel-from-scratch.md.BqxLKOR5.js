import{_ as i,c as a,o as n,ai as l}from"./chunks/framework.CzX2Xjny.js";const b=JSON.parse('{"title":"ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„ OS Kernel","description":"","frontmatter":{"title":"ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„ OS Kernel","date":"2024-04-28T00:00:00.000Z","category":"OS","tags":["Kernel","C","Assembly","Low-level"],"readTime":"15 min","excerpt":"æ“ä½œç³»ç»Ÿçš„å¼•å¯¼è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå¦‚ä½•ä»å®æ¨¡å¼åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ï¼Ÿè®©æˆ‘ä»¬åŠ¨æ‰‹å†™ä¸€ä¸ª Hello World çº§åˆ«çš„å†…æ ¸ï¼Œæ¢ç´¢è®¡ç®—æœºå¯åŠ¨çš„å¥¥ç§˜...","image":"https://images.unsplash.com/photo-1518432031352-d6fc5c10da5a?auto=format&fit=crop&q=80&w=1000"},"headers":[],"relativePath":"posts/os-kernel-from-scratch.md","filePath":"posts/os-kernel-from-scratch.md","lastUpdated":1767687810000}'),p={name:"posts/os-kernel-from-scratch.md"};function e(h,s,k,t,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„-os-kernel" tabindex="-1">ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„ OS Kernel <a class="header-anchor" href="#ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„-os-kernel" aria-label="Permalink to &quot;ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„ OS Kernel&quot;">â€‹</a></h1><p>è®©æˆ‘ä»¬åŠ¨æ‰‹å†™ä¸€ä¸ª Hello World çº§åˆ«çš„å†…æ ¸ï¼Œæ¢ç´¢è®¡ç®—æœºå¯åŠ¨çš„å¥¥ç§˜ã€‚</p><h2 id="å¼•å¯¼è¿‡ç¨‹" tabindex="-1">å¼•å¯¼è¿‡ç¨‹ <a class="header-anchor" href="#å¼•å¯¼è¿‡ç¨‹" aria-label="Permalink to &quot;å¼•å¯¼è¿‡ç¨‹&quot;">â€‹</a></h2><p>è®¡ç®—æœºå¯åŠ¨æ—¶ï¼ŒBIOS ä¼šåŠ è½½å¼•å¯¼æ‰‡åŒºï¼ˆBoot Sectorï¼‰åˆ°å†…å­˜åœ°å€ <code>0x7c00</code>ã€‚</p><h3 id="ç¼–å†™å¼•å¯¼ä»£ç " tabindex="-1">ç¼–å†™å¼•å¯¼ä»£ç  <a class="header-anchor" href="#ç¼–å†™å¼•å¯¼ä»£ç " aria-label="Permalink to &quot;ç¼–å†™å¼•å¯¼ä»£ç &quot;">â€‹</a></h3><div class="language-asm vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">asm</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[org </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x7c00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[bits </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> si</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hello</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> print_string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print_string:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    lodsb</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    or</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .done</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ah</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x0e</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> print_string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">done:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hello:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &#39;Hello, OS World!&#39;, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">times</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 510</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-($-$$) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xaa55</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="å…³é”®æ¦‚å¿µ" tabindex="-1">å…³é”®æ¦‚å¿µ <a class="header-anchor" href="#å…³é”®æ¦‚å¿µ" aria-label="Permalink to &quot;å…³é”®æ¦‚å¿µ&quot;">â€‹</a></h3><ul><li><code>[org 0x7c00]</code>: å‘Šè¯‰æ±‡ç¼–å™¨ä»£ç å°†è¢«åŠ è½½åˆ°å†…å­˜åœ°å€ 0x7c00</li><li><code>[bits 16]</code>: æŒ‡å®šç”Ÿæˆ 16 ä½å®æ¨¡å¼ä»£ç </li><li><code>0xaa55</code>: å¼•å¯¼æ‰‡åŒºç­¾åï¼ŒBIOS é€šè¿‡å®ƒè¯†åˆ«å¼•å¯¼è®¾å¤‡</li></ul><h2 id="ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼" tabindex="-1">ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ <a class="header-anchor" href="#ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼" aria-label="Permalink to &quot;ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼&quot;">â€‹</a></h2><p>å®æ¨¡å¼ä¸‹åªèƒ½è®¿é—® 1MB å†…å­˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ã€‚</p><h3 id="å…¨å±€æè¿°ç¬¦è¡¨-gdt" tabindex="-1">å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆGDTï¼‰ <a class="header-anchor" href="#å…¨å±€æè¿°ç¬¦è¡¨-gdt" aria-label="Permalink to &quot;å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆGDTï¼‰&quot;">â€‹</a></h3><div class="language-asm vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">asm</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdt_start:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  ; null descriptor</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdt_code:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xffff</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               ; limit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  ; base (low)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  ; base (middle)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10011010b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            ; access</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11001111b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            ; granularity</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  ; base (high)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdt_data:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xffff</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10010010b</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11001111b</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdt_end:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdt_descriptor:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gdt_end - gdt_start - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    dd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gdt_start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼" tabindex="-1">åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ <a class="header-anchor" href="#åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼" aria-label="Permalink to &quot;åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼&quot;">â€‹</a></h3><div class="language-asm vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">asm</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cli</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                         ; å…³é—­ä¸­æ–­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">lgdt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [gdt_descriptor]       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; åŠ è½½ GDT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eax</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cr0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eax</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 ; è®¾ç½®ä¿æŠ¤æ¨¡å¼ä½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cr0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">jmp</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CODE_SEG:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">init_pm        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; è¿œè·³è½¬åˆ° 32 ä½ä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[bits </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init_pm:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ax</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, DATA_SEG</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> es</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ax</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ebp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x90000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> esp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ebp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kernel_main</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="ç¼–å†™ç®€å•çš„å†…æ ¸" tabindex="-1">ç¼–å†™ç®€å•çš„å†…æ ¸ <a class="header-anchor" href="#ç¼–å†™ç®€å•çš„å†…æ ¸" aria-label="Permalink to &quot;ç¼–å†™ç®€å•çš„å†…æ ¸&quot;">â€‹</a></h2><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// kernel.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> kernel_main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">video_memory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">b8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hello from Kernel!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        video_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        video_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ç™½å­—é»‘åº•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æŒ‚èµ·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="æ„å»ºä¸è¿è¡Œ" tabindex="-1">æ„å»ºä¸è¿è¡Œ <a class="header-anchor" href="#æ„å»ºä¸è¿è¡Œ" aria-label="Permalink to &quot;æ„å»ºä¸è¿è¡Œ&quot;">â€‹</a></h2><h3 id="makefile" tabindex="-1">Makefile <a class="header-anchor" href="#makefile" aria-label="Permalink to &quot;Makefile&quot;">â€‹</a></h3><div class="language-makefile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">boot.bin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: boot.asm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	nasm -f bin boot.asm -o boot.bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel.o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: kernel.c</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	gcc -m32 -c kernel.c -o kernel.o -ffreestanding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kernel.bin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: kernel.o</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ld -m elf_i386 -Ttext 0x1000 kernel.o -o kernel.bin --oformat binary</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os.bin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: boot.bin kernel.bin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	cat boot.bin kernel.bin &gt; os.bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: os.bin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	qemu-system-x86_64 -drive format=raw,file=os.bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	rm -f *.bin *.o</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="è¿è¡Œ" tabindex="-1">è¿è¡Œ <a class="header-anchor" href="#è¿è¡Œ" aria-label="Permalink to &quot;è¿è¡Œ&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="ä¸‹ä¸€æ­¥" tabindex="-1">ä¸‹ä¸€æ­¥ <a class="header-anchor" href="#ä¸‹ä¸€æ­¥" aria-label="Permalink to &quot;ä¸‹ä¸€æ­¥&quot;">â€‹</a></h2><p>ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªæœ€ç®€å•çš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼æ¥ä¸‹æ¥å¯ä»¥ï¼š</p><ul><li>ğŸ”§ å®ç°ä¸­æ–­å¤„ç†ï¼ˆIDTï¼‰</li><li>ğŸ’¾ æ·»åŠ å†…å­˜ç®¡ç†</li><li>âŒ¨ï¸ å®ç°é”®ç›˜é©±åŠ¨</li><li>ğŸ“Ÿ å®ç°ç®€å•çš„ Shell</li></ul><h2 id="å‚è€ƒèµ„æº" tabindex="-1">å‚è€ƒèµ„æº <a class="header-anchor" href="#å‚è€ƒèµ„æº" aria-label="Permalink to &quot;å‚è€ƒèµ„æº&quot;">â€‹</a></h2><ul><li><a href="https://wiki.osdev.org/" target="_blank" rel="noreferrer">OSDev Wiki</a></li><li><a href="https://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf" target="_blank" rel="noreferrer">Writing a Simple Operating System from Scratch</a></li><li><a href="https://littleosbook.github.io/" target="_blank" rel="noreferrer">The little book about OS development</a></li></ul><hr><p>è¿™å°±æ˜¯æ“ä½œç³»ç»Ÿå¼€å‘çš„ç¬¬ä¸€æ­¥ï¼ğŸš€</p>`,28)])])}const g=i(p,[["render",e]]);export{b as __pageData,g as default};
